{% extends 'base.html' %}

{% load static %}

{% block title %} Все рецепты {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/all_recipes.css' %}">
{% endblock %}

{% block content %}
<div class="filters-container" style="margin-bottom: 20px;">
    <form method="get" class="filters-form">
        <div class="filter-item">
            <label for="time_min">Время от:</label>
            <input type="number" id="time_min" name="time_min" value="{{ request.GET.time_min }}" min="0">
        </div>

        <div class="filter-item">
            <label for="time_max">Время до:</label>
            <input type="number" id="time_max" name="time_max" value="{{ request.GET.time_max }}" min="0">
        </div>

        <div class="filter-item">
            <label for="ingredients_count">ОТ Кол-во ингредиентов:</label>
            <input type="number" id="ingredients_count" name="ingredients_count" value="{{ request.GET.ingredients_count }}" min="0">
        </div>

        <div class="filter-item">
            <label for="order">Сортировка:</label>
            <select id="order" name="order">
                <option value="">По умолчанию</option>
                <option value="asc" {% if request.GET.order == 'asc' %}selected{% endif %}>А–Я</option>
                <option value="desc" {% if request.GET.order == 'desc' %}selected{% endif %}>Я–А</option>
            </select>
        </div>

        <button type="submit" class="btn btn-secondary">Применить фильтры</button>
        <button class="btn btn-secondary" type="submit"><a href="{% url 'all_recipes' %}" style="text-decoration: none; color: white;" >Сбросить фильтры</a></button>

    </form>
</div>

<div class="all-recipes-container">
    <h1>Все рецепты</h1>
    
    {% if recipes %}
        <div class="recipes-grid">
            {% for recipe in recipes %}
            <div class="recipe-card">
                {% if recipe.image %}
                    <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">
                {% else %}
                    <div class="recipe-image-placeholder">Нет изображения</div>
                {% endif %}
                
                <div class="recipe-content">
                    <h3 class="recipe-title">{{ recipe.title }}</h3>
                    <p class="recipe-description">{{ recipe.description|truncatewords:20 }}</p>
                    
                    <div class="recipe-meta">
                        <span class="cooking-time">⏱️ {{ recipe.cooking_time }} мин.</span>
                    </div>
                    
                    <div class="recipe-ingredients">
                        <strong>Ингредиенты:</strong>
                        <ul>
                            {% for ingredient in recipe.ingredients.all|slice:":3" %}
                                <li>{{ ingredient.name }}</li>
                            {% endfor %}
                            {% if recipe.ingredients.count > 3 %}
                                <li>... и еще {{ recipe.ingredients.count|add:"-3" }}</li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-primary">Посмотреть рецепт</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-recipes">
            <p>Рецептов пока нет в базе данных.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
